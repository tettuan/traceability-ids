# Step 3: 実文書分析

## 目的

Step 2で特定した重点問題について、実際のMarkdownファイルを読み、
具体的な文書内容を把握して所見をまとめる。

## 手順

### 問題種別ごとの分析手法

#### CRITICAL / HIGH: スコープのレベル欠損

**目的**: 何の機能のことで、何が足りないのかを具体的に把握する。

1. **ファイル特定**
   ```
   Grep: pattern="{scope}:" path="{input-dir}" glob="*.md"
   ```
   該当スコープのIDを含むファイルを特定する。

2. **文書読み込み**
   ```
   Read: 上位3ファイル（IDの出現が多い順）
   ```
   読む際に以下を把握:
   - **見出し構造**: h1/h2/h3の階層
   - **扱っている機能**: 何のための文書か
   - **記述の粒度**: 概要レベルか、詳細仕様レベルか
   - **IDの使われ方**: 要件定義、仕様記述、設計判断のどれか

3. **所見をまとめる**
   各スコープについて以下を記述:
   - **現状**: 「{scope}スコープは{機能名}に関する{level}レベルの文書で、{概要}を記述している」
   - **欠損**: 「{不足level}が存在しない。具体的には{何が足りないか}」
   - **改善案**: 「{具体的に作成すべき文書の内容}」

#### NEAR_DUP: 近似IDペア

**目的**: 本当に統合すべきか、バージョン違いで正当かを判断する。

1. **両IDの出現箇所を特定**
   ```
   Grep: pattern="ID-A" path="{input-dir}"
   Grep: pattern="ID-B" path="{input-dir}"
   ```

2. **周辺コンテキストを読む**
   各IDの出現ファイルをReadし、IDの前後10行程度を読む。
   - 同じ内容を記述しているか
   - バージョン更新で旧版が残っているだけか
   - 異なる文脈で使われているか

3. **所見をまとめる**
   - **判定**: 「統合すべき」/「バージョン管理で正当」/「別文脈で使用」
   - **理由**: 「ID-Aは{内容A}、ID-Bは{内容B}を記述しており、{理由}」

#### CROSS_DUP: ファイル横断重複

**目的**: 参照として正当か、コピペ重複かを判断する。

1. **出現ファイル一覧**
   ```
   Grep: pattern="該当ID" path="{input-dir}" output_mode="files_with_matches"
   ```

2. **代表3ファイルを読む**
   出現ファイルのうち代表的なものを3つ読み、IDの使われ方を確認:
   - **正本**: IDが定義されているファイル（要件定義書等）
   - **参照**: IDを引用しているファイル（仕様書、設計書等）
   - **重複**: 同一内容がコピペされているファイル

3. **所見をまとめる**
   - **正本ファイル**: 「{ファイル名}でこのIDの要件が定義されている」
   - **参照パターン**: 「{N}ファイルが正当な参照として引用」
   - **コピペ疑い**: 「{ファイル名}は正本と同一内容のコピペの可能性」

### 分析の制約

- **読むファイル数**: 各問題につき最大3ファイル（コンテキスト節約）
- **読む範囲**: 全文ではなく、IDの周辺コンテキスト + 見出し構造を中心に
- **時間制約**: 全10問題で計30ファイル以内に収める

## 次ステップへの引き渡し

各問題の所見（現状・欠損・改善案）を Step 4 のレポートテンプレートに組み込む。
