# Step 1: メトリクス生成

## 目的

analyze CLI を実行し、機械的メトリクスレポートを自動生成する。
このレポートが以降のステップの入力データとなる。

## 手順

### 1. CLI実行

```bash
INPUT_DIR="$ARGUMENTS"  # ユーザー指定のディレクトリ（デフォルト: data/）
deno run --allow-read --allow-write analyze.ts "$INPUT_DIR" --output tmp/analyze-report.md
```

stderrに進捗が出力される（ファイル数、ID数、クラスタ数等）。
この進捗をユーザーに報告する。

### 2. 出力確認

`tmp/analyze-report.md` が生成されたことを確認。
生成されなかった場合はエラーを報告して終了。

### 3. ユーザーへの中間報告

CLIの stderr 出力から以下をユーザーに報告:

- スキャンしたファイル数
- 抽出したID数（重複込み / ユニーク）
- クラスタ数

例:

```
116ファイルをスキャン、851ユニークID（2864重複込み）、223クラスタを検出しました。
メトリクスレポートを生成中...
```

## 出力

- `tmp/analyze-report.md` — 以下のセクションを含む:
  1. サマリー（4観点の評価スコア）
  2. 構成分析（Level×Scope マトリクス、チェーン完成率）
  3. 詳細度分析（仕様化率、バージョン鮮度）
  4. 重複度分析（近似IDペア、ファイル横断重複）
  5. 抜け漏れ分析（レベル欠損、孤立スコープ、低連結ノード）
  6. 改善アクション一覧（優先度付き）

## 次ステップへの引き渡し

Step 2では `tmp/analyze-report.md` を Read で読み込む。
