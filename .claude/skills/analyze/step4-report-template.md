# Step 4: 統合レポート生成

## 目的

メトリクス分析（Step 1）と実文書分析（Step 3）を統合し、
具体的な改善箇所と実際の文書内容の要約を含む最終レポートを生成する。

## 出力先

```
Write: tmp/analyze-deep-report.md
```

## レポートテンプレート

以下のテンプレートに従ってレポートを生成する。
`{...}` 部分は実際の分析結果で置き換える。

---

```markdown
# トレーサビリティID 文書改善レポート

- **生成日時**: {YYYY-MM-DD HH:MM}
- **対象ディレクトリ**: {input-dir}
- **ファイル数**: {N}
- **ユニークID数**: {N} (重複込み: {N})
- **クラスタ数**: {N}

## 1. サマリースコアカード

| 観点     | メトリクス     | 値    | 評価 |
| -------- | -------------- | ----- | ---- |
| 構成     | カバレッジ率   | {N}%  | {A-D}|
| 構成     | チェーン完成率 | {N}%  | {A-D}|
| 詳細度   | 平均仕様化率   | {N}   | {A-D}|
| 詳細度   | バージョン鮮度 | {N}%  | {A-D}|
| 重複度   | 近似ID率       | {N}%  | {A-D}|
| 抜け漏れ | 孤立スコープ率 | {N}%  | {A-D}|

### 総合所見

{D評価の観点を中心に、文書体系全体の状況を2-3文で要約}

## 2. 重点問題の詳細分析

{Step 2で特定した最大10件の問題について、1件ずつ以下の形式で記述}

### 2.1 {問題タイトル}

**種別**: {CRITICAL / HIGH / NEAR_DUP / CROSS_DUP}
**対象**: {スコープ名 or ID}

#### 現状

{実文書を読んで把握した内容の要約。何が書かれているか。
具体的なファイル名と見出し構造にも言及する。}

> {文書からの引用や代表的な記述の要約。具体性を持たせる。}

#### 問題点

{何が足りないか、何が冗長か。メトリクスと文書内容の両面から指摘。}

#### 改善アクション

{具体的に何をすべきか。作成すべき文書の種類と内容、
統合すべきIDのペア、整理すべきファイル等。}

{--- 以下、問題ごとに繰り返し ---}

## 3. メトリクス詳細

{analyze-report.md のサマリーテーブル部分を転記。
Level×Scope マトリクス、チェーン結果、ギャップマップ等。
全データは tmp/analyze-report.md を参照するよう誘導する。}

### Level×Scope カバレッジマトリクス

{analyze-report.md の表を転記}

### トレーサビリティギャップマップ

{analyze-report.md のギャップマップを転記}

## 4. 改善アクション一覧（優先度順）

{Step 3の所見を反映した、具体的な改善アクションリスト。
CLIレポートの機械的なアクションを、文書分析で具体化する。}

| # | 優先度 | 対象 | アクション | 備考 |
|---|--------|------|------------|------|
| 1 | CRITICAL | {scope} | {具体的な内容。例: ○○機能の要件定義書を作成。△△の設計書に根拠となるreqを追加} | {文書分析からの補足} |
| 2 | HIGH | {scope} | {具体的な内容} | |
| ... | | | | |

## 付録

- 機械的メトリクスの全データ: `tmp/analyze-report.md`
- グラフ可視化: `tmp/graph-3d.html`
```

---

## 記述ガイドライン

### 具体性

- 抽象的な「改善が必要」ではなく、「{機能名}の{文書種別}を作成し、{内容}を記述する」
- 実文書から読み取った機能名・技術要素を使う
- 例: ×「backup scopeにreqを追加」→ ○「バックアップ・リストア機能の要件定義書を作成。自動バックアップの頻度、保持期間、リストア手順の要件を定義する」

### 引用

- 文書内容の要約には `>` 引用ブロックを使い、具体的な記述を示す
- 見出し構造は実際のファイルの見出しを列挙する

### 分量

- 各問題の詳細分析: 100-200文字程度
- 総レポート: 200-400行程度
- 簡潔さと具体性のバランスを保つ
